<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Profi Szabadság Kezelő 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #f8fafc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .matrix-table th, .matrix-table td { border: 1px solid #e2e8f0; text-align: center; min-width: 35px; height: 40px; }
        .name-col { position: sticky; left: 0; background: white; z-index: 20; min-width: 200px !important; text-align: left !important; padding-left: 10px; box-shadow: 2px 0 5px rgba(0,0,0,0.05); }
        .weekend { background-color: #f1f5f9; }
        .status-S { background-color: #3b82f6; color: white; font-weight: bold; } /* Szabadság */
        .status-B { background-color: #ef4444; color: white; font-weight: bold; } /* Beteg */
        .status-K { background-color: #f59e0b; color: white; font-weight: bold; } /* Késés */
        .status-I { background-color: #7c3aed; color: white; font-weight: bold; } /* Igazolatlan */
        .input-cell { width: 100%; height: 100%; border: none; text-align: center; background: transparent; cursor: pointer; }
        .input-cell:focus { background: #e0f2fe; outline: 2px solid #3b82f6; }
    </style>
</head>
<body class="p-6">

    <div class="max-w-[98%] mx-auto bg-white rounded-xl shadow-2xl overflow-hidden border border-slate-200">
        
        <div class="bg-slate-800 p-6 text-white flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-calendar-check text-blue-400"></i> Corporate Leave Manager v1.0
                </h1>
                <p class="text-slate-400 text-sm">Csapatmenedzsment és Munkaidő Nyilvántartó</p>
            </div>
            
            <div class="flex items-center gap-4 bg-slate-700 p-3 rounded-lg">
                <button onclick="changeMonth(-1)" class="hover:text-blue-400"><i class="fas fa-chevron-left"></i></button>
                <h2 id="currentMonthDisplay" class="text-lg font-bold min-w-[150px] text-center uppercase tracking-widest">2025 Január</h2>
                <button onclick="changeMonth(1)" class="hover:text-blue-400"><i class="fas fa-chevron-right"></i></button>
            </div>

            <div class="flex gap-2">
                <button onclick="addNewEmployee()" class="bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded-lg text-sm font-bold transition">
                    <i class="fas fa-user-plus mr-2"></i> Új munkatárs
                </button>
                <button onclick="exportData()" class="bg-emerald-600 hover:bg-emerald-500 px-4 py-2 rounded-lg text-sm font-bold transition">
                    <i class="fas fa-file-export mr-2"></i> Export (JSON)
                </button>
            </div>
        </div>

        <div class="p-4 bg-slate-50 border-b flex gap-6 text-xs font-bold text-slate-600">
            <div class="flex items-center gap-2"><span class="w-4 h-4 status-S rounded"></span> SZABADSÁG (óraszám)</div>
            <div class="flex items-center gap-2"><span class="w-4 h-4 status-B rounded"></span> BETEGÁLLOMÁNY (B)</div>
            <div class="flex items-center gap-2"><span class="w-4 h-4 status-K rounded"></span> KÉSÉS (K + perc)</div>
            <div class="flex items-center gap-2"><span class="w-4 h-4 status-I rounded"></span> IGAZOLATLAN (I)</div>
            <div class="ml-auto text-slate-400 italic">Tipp: Kattints egy cellába és írj be egy számot vagy kódot!</div>
        </div>

        <div class="overflow-x-auto">
            <table class="matrix-table w-full border-collapse">
                <thead id="tableHeader">
                    </thead>
                <tbody id="tableBody">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        let currentDate = new Date();
        let employees = JSON.parse(localStorage.getItem('hr_matrix_data')) || [
            { id: 1, name: 'Minta János', yearlyQuota: 160, data: {} },
            { id: 2, name: 'Kovács Anna', yearlyQuota: 160, data: {} }
        ];

        function save() {
            localStorage.setItem('hr_matrix_data', JSON.stringify(employees));
            render();
        }

        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            render();
        }

        function addNewEmployee() {
            const name = prompt("Munkatárs neve:");
            if (name) {
                const quota = prompt("Éves keretóra (pl. 160):", "160");
                employees.push({
                    id: Date.now(),
                    name: name,
                    yearlyQuota: parseInt(quota) || 0,
                    data: {}
                });
                save();
            }
        }

        function updateCell(empId, dateKey, value) {
            const emp = employees.find(e => e.id === empId);
            if (emp) {
                if (value === "") {
                    delete emp.data[dateKey];
                } else {
                    emp.data[dateKey] = value.toUpperCase();
                }
                save();
            }
        }

        function render() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const monthName = currentDate.toLocaleString('hu-HU', { month: 'long', year: 'numeric' });
            
            document.getElementById('currentMonthDisplay').innerText = monthName;

            // Header generálás
            let headerHtml = `<tr><th class="name-col font-bold p-3 bg-slate-100">Név / Napok</th><th class="bg-blue-50 text-blue-600 px-2 text-xs uppercase">Keret</th><th class="bg-emerald-50 text-emerald-600 px-2 text-xs uppercase">Maradék</th>`;
            for (let d = 1; d <= daysInMonth; d++) {
                const dayName = new Date(year, month, d).toLocaleString('hu-HU', { weekday: 'short' });
                const isWeekend = new Date(year, month, d).getDay() === 0 || new Date(year, month, d).getDay() === 6;
                headerHtml += `<th class="${isWeekend ? 'weekend text-red-400' : 'bg-white'} text-[10px] font-bold p-1">
                    ${d}<br><span class="opacity-60">${dayName}</span>
                </th>`;
            }
            headerHtml += `</tr>`;
            document.getElementById('tableHeader').innerHTML = headerHtml;

            // Body generálás
            let bodyHtml = "";
            employees.forEach(emp => {
                let usedHours = 0;
                // Összes felhasznált óra számítása (csak a számokat adjuk össze)
                Object.keys(emp.data).forEach(key => {
                    const val = emp.data[key];
                    if (!isNaN(val) && val !== "") usedHours += parseFloat(val);
                });

                bodyHtml += `<tr>
                    <td class="name-col font-semibold text-slate-700">
                        <div class="flex justify-between items-center pr-2">
                            ${emp.name}
                            <button onclick="removeEmp(${emp.id})" class="text-slate-300 hover:text-red-500 text-[10px]"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                    <td class="bg-blue-50/30 font-bold text-blue-600">${emp.yearlyQuota}</td>
                    <td class="bg-emerald-50/30 font-bold text-emerald-600">${emp.yearlyQuota - usedHours}</td>`;
                
                for (let d = 1; d <= daysInMonth; d++) {
                    const dateKey = `${year}-${month + 1}-${d}`;
                    const val = emp.data[dateKey] || "";
                    let statusClass = "";
                    if (!isNaN(val) && val !== "") statusClass = "status-S";
                    else if (val.startsWith('B')) statusClass = "status-B";
                    else if (val.startsWith('K')) statusClass = "status-K";
                    else if (val.startsWith('I')) statusClass = "status-I";

                    const isWeekend = new Date(year, month, d).getDay() === 0 || new Date(year, month, d).getDay() === 6;

                    bodyHtml += `<td class="${isWeekend ? 'weekend' : ''} ${statusClass} p-0">
                        <input type="text" 
                               value="${val}" 
                               onblur="updateCell(${emp.id}, '${dateKey}', this.value)"
                               class="input-cell" 
                               placeholder="-">
                    </td>`;
                }
                bodyHtml += `</tr>`;
            });
            document.getElementById('tableBody').innerHTML = bodyHtml;
        }

        function removeEmp(id) {
            if(confirm("Biztosan törlöd a munkatársat és minden adatát?")) {
                employees = employees.filter(e => e.id !== id);
                save();
            }
        }

        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(employees));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "hr_mentes_" + new Date().toISOString().slice(0,10) + ".json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        render();
    </script>
</body>
</html>
