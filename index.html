<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FORVIA | Staff Pro 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0b0f1a; color: #e2e8f0; margin: 0; }
        .table-container { overflow-x: auto; border-radius: 8px; background: #111827; position: relative; }
        .name-col { position: sticky; left: 0; background: #1e293b; z-index: 40; min-width: 160px; border-right: 2px solid #3b82f6 !important; padding: 0 8px !important; }
        .matrix-table th, .matrix-table td { border: 1px solid #2d3748; min-width: 38px; height: 38px; text-align: center; font-size: 12px; position: relative; }
        .day-name { font-size: 7px; text-transform: uppercase; color: #64748b; font-weight: 800; display: block; line-height: 1; }
        .weekend { background: #141b2d !important; color: #64748b; }
        .holiday { background: #4c0505 !important; color: #fca5a5 !important; border: 1px solid #7f1d1d !important; }
        .today-cell { border: 2px solid #3b82f6 !important; background: rgba(59, 130, 246, 0.15) !important; }
        
        /* ÚJ: AKTÍV OSZLOP KIEMELÉS */
        .col-highlight { background: rgba(59, 130, 246, 0.2) !important; transition: all 0.2s ease; }
        .head-highlight { background: #3b82f6 !important; color: white !important; transform: scale(1.1); z-index: 50; transition: all 0.2s ease; box-shadow: 0 0 15px rgba(59, 130, 246, 0.5); }

        .cell-S { background: #059669 !important; color: white !important; }
        .cell-BA { background: #ea580c !important; color: white !important; }
        .cell-IG { background: #7c3aed !important; color: white !important; }
        .cell-TU { background: #2563eb !important; color: white !important; }
        .cell-KE { background: #d97706 !important; color: white !important; }
        .input-cell { width: 100%; height: 100%; border: none; text-align: center; background: transparent; color: white; font-weight: 800; outline: none; }
        
        @media print {
            .no-print { display: none !important; }
            body, html { background: white !important; color: black !important; }
            #print-area { display: block !important; background: white !important; color: black !important; }
            .print-page { width: 100%; padding: 10mm; background: white !important; color: black !important; }
            table { width: 100%; border-collapse: collapse; background: white !important; }
            th, td { border: 1px solid black !important; padding: 4px; font-size: 10pt; color: black !important; background: white !important; }
            @page { size: A4 portrait; margin: 0; }
        }
    </style>
</head>
<body class="pb-10">
    <div id="print-area" class="hidden"></div>
    <header class="bg-[#111827] border-b border-slate-800 p-3 sticky top-0 z-50 no-print">
        <div class="max-w-full mx-auto flex flex-wrap justify-between items-center gap-3">
            <div class="flex items-center gap-3">
                <div class="flex flex-col">
                    <span class="text-blue-500 font-black text-xl tracking-tighter leading-none">FORVIA</span>
                    <span class="text-[8px] text-slate-500 uppercase font-bold">Staff Pro 2026</span>
                </div>
                <nav class="flex bg-slate-900 p-1 rounded-lg">
                    <button onclick="setView('matrix')" id="btn-matrix" class="px-3 py-1.5 rounded-md bg-blue-600 text-[10px] font-bold uppercase transition">Mátrix</button>
                    <button onclick="setView('stats')" id="btn-stats" class="px-3 py-1.5 rounded-md text-[10px] font-bold uppercase transition ml-1">Adatlapok</button>
                </nav>
            </div>
            <div class="flex items-center gap-2 bg-slate-900/80 border border-slate-700 px-3 py-1 rounded-lg">
                <button onclick="changeMonth(-1)" class="text-slate-400"><i class="fas fa-chevron-left text-xs"></i></button>
                <span id="currentMonthDisplay" class="font-black text-[10px] uppercase tracking-tighter w-24 text-center text-blue-400">Január</span>
                <button onclick="changeMonth(1)" class="text-slate-400"><i class="fas fa-chevron-right text-xs"></i></button>
            </div>
            <div class="flex gap-2">
                <button onclick="addNewEmployee()" class="bg-emerald-600 hover:bg-emerald-500 px-3 py-1.5 rounded text-[10px] font-black uppercase flex items-center gap-2 text-white"><i class="fas fa-plus"></i> <span>Új dolgozó</span></button>
                <button onclick="exportData()" class="bg-slate-700 px-3 py-1.5 rounded text-[10px] text-white"><i class="fas fa-file-export"></i></button>
            </div>
        </div>
    </header>

    <main class="p-2 no-print">
        <div id="view-matrix">
            <div class="table-container shadow-2xl">
                <table class="matrix-table w-full border-collapse" id="mainMatrix">
                    <thead id="tableHeader" class="bg-slate-800 text-slate-400"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
        <div id="view-stats" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
    </main>

    <script>
        let currentDate = new Date(2026, 0, 1);
        const dayNames = ['V', 'H', 'K', 'Sze', 'Cs', 'P', 'Szo'];
        const monthNames = ["Január", "Február", "Március", "Április", "Május", "Június", "Július", "Augusztus", "Szeptember", "Október", "November", "December"];
        const holidays2026 = ["2026-1-1", "2026-3-15", "2026-4-3", "2026-4-5", "2026-4-6", "2026-5-1", "2026-5-24", "2026-5-25", "2026-8-20", "2026-10-23", "2026-11-1", "2026-12-25", "2026-12-26"];

        let employees = JSON.parse(localStorage.getItem('forvia_v2026_pro')) || [{ id: 1, name: 'Példa János', yearlyQuota: 160, data: {} }];

        function save() { localStorage.setItem('forvia_v2026_pro', JSON.stringify(employees)); }

        // ÚJ: OSZLOP KIEMELÉS LOGIKA
        function highlightCol(colIndex, active) {
            const table = document.getElementById('mainMatrix');
            const rows = table.rows;
            for (let i = 0; i < rows.length; i++) {
                const cell = rows[i].cells[colIndex];
                if (cell) {
                    if (i === 0) { // Fejléc
                        cell.classList.toggle('head-highlight', active);
                    } else { // Adat sorok
                        cell.classList.toggle('col-highlight', active);
                    }
                }
            }
        }

        function setView(view) {
            document.getElementById('view-matrix').classList.toggle('hidden', view !== 'matrix');
            document.getElementById('view-stats').classList.toggle('hidden', view !== 'stats');
            document.getElementById('btn-matrix').classList.toggle('bg-blue-600', view === 'matrix');
            document.getElementById('btn-stats').classList.toggle('bg-blue-600', view === 'stats');
            if(view === 'stats') renderStats();
        }

        function changeMonth(delta) { currentDate.setMonth(currentDate.getMonth() + delta); render(); }

        function getCellClass(v) {
            if (!v) return "";
            if (!isNaN(v)) return "cell-S";
            if (v === 'BÁ') return "cell-BA";
            if (v === 'IG') return "cell-IG";
            if (v === 'TU') return "cell-TU";
            if (v.startsWith('KÉ')) return "cell-KE";
            return "";
        }

        function updateCell(id, key, val, inputElement) {
            const emp = employees.find(e => e.id === id);
            const v = val.trim().toUpperCase();
            if(v === "") delete emp.data[key]; else emp.data[key] = v;
            inputElement.parentElement.className = inputElement.parentElement.className.replace(/cell-\S+/g, "").trim();
            const newClass = getCellClass(v);
            if(newClass) inputElement.parentElement.classList.add(newClass);
            save();
            updateRowTotals(id);
        }

        function updateRowTotals(id) {
            const emp = employees.find(e => e.id === id);
            let sSum = 0; 
            Object.values(emp.data).forEach(v => { if(!isNaN(v) && v !== "") sSum += parseFloat(v); });
            const remDisplay = document.getElementById(`rem-${id}`);
            if(remDisplay) remDisplay.innerText = (emp.yearlyQuota - sSum);
        }

        function render() {
            const year = 2026; const month = currentDate.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const realToday = new Date();
            document.getElementById('currentMonthDisplay').innerText = monthNames[month];

            let header = `<tr><th class="name-col text-[9px] uppercase font-black">Munkatárs</th><th class="w-12 text-blue-400 text-[8px] uppercase font-black">Keret</th><th class="w-12 text-emerald-400 text-[8px] uppercase font-black">Kiv.</th>`;
            for(let d=1; d<=daysInMonth; d++) {
                const isW = [0, 6].includes(new Date(year, month, d).getDay());
                const isToday = realToday.getFullYear() === year && realToday.getMonth() === month && realToday.getDate() === d;
                header += `<th class="${isW ? 'weekend' : ''} ${holidays2026.includes(`${year}-${month+1}-${d}`) ? 'holiday' : ''} ${isToday ? 'today-cell' : ''}">${d}<span class="day-name">${dayNames[new Date(year, month, d).getDay()]}</span></th>`;
            }
            document.getElementById('tableHeader').innerHTML = header + "</tr>";

            let body = "";
            employees.forEach(emp => {
                let sSum = 0; Object.values(emp.data).forEach(v => { if(!isNaN(v) && v !== "") sSum += parseFloat(v); });
                body += `<tr><td class="name-col flex justify-between items-center"><span class="font-bold text-[11px] truncate">${emp.name}</span>
                <div class="flex gap-1"><button onclick="printA4(${emp.id})" class="text-slate-500"><i class="fas fa-print text-[10px]"></i></button><button onclick="removeEmp(${emp.id})" class="text-red-900/50 hover:text-red-500"><i class="fas fa-trash text-[10px]"></i></button></div></td>
                <td><input type="number" value="${emp.yearlyQuota}" onblur="emp.yearlyQuota=parseInt(this.value)||0; save(); render();" class="input-cell text-blue-400 text-[11px]"></td>
                <td id="rem-${emp.id}" class="text-emerald-500 font-black text-[11px]">${emp.yearlyQuota - sSum}</td>`;
                for(let d=1; d<=daysInMonth; d++) {
                    const key = `${year}-${month+1}-${d}`; const v = emp.data[key] || "";
                    const isW = [0, 6].includes(new Date(year, month, d).getDay());
                    const isToday = realToday.getFullYear() === year && realToday.getMonth() === month && realToday.getDate() === d;
                    const colIdx = d + 2; // Név, Keret, Kiv oszlopok miatt eltolás
                    body += `<td class="${isW ? 'weekend' : ''} ${holidays2026.includes(`${year}-${month+1}-${d}`) ? 'holiday' : ''} ${isToday ? 'today-cell' : ''} ${getCellClass(v)}">
                        <input type="text" value="${v}" 
                            onfocus="highlightCol(${colIdx}, true)" 
                            onblur="highlightCol(${colIdx}, false); updateCell(${emp.id}, '${key}', this.value, this)" 
                            class="input-cell">
                    </td>`;
                }
                body += `</tr>`;
            });
            document.getElementById('tableBody').innerHTML = body;
        }

        function renderStats() {
            document.getElementById('view-stats').innerHTML = employees.map(emp => {
                let s = { S:0, BA:0, IG:0, TU:0, KE:0 };
                Object.values(emp.data).forEach(v => { if(!isNaN(v)) s.S+=parseFloat(v); else if(v==='BÁ') s.BA++; else if(v==='IG') s.IG++; else if(v==='TU') s.TU++; else if(v.startsWith('KÉ')) s.KE++; });
                return `<div class="bg-slate-800/40 p-4 rounded-xl border border-slate-700 relative">
                    <button onclick="removeEmp(${emp.id})" class="absolute top-2 right-2 text-red-900/50 hover:text-red-500"><i class="fas fa-trash text-xs"></i></button>
                    <h3 class="text-sm font-black mb-2 truncate pr-6">${emp.name}</h3>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <div class="bg-slate-900 p-2 rounded-lg text-center"><p class="text-[8px] text-slate-500 uppercase">Kivehető</p><p class="text-sm font-black text-emerald-500">${emp.yearlyQuota - s.S}</p></div>
                        <div class="bg-slate-900 p-2 rounded-lg text-center"><p class="text-[8px] text-slate-500 uppercase">Szabadság</p><p class="text-sm font-black text-white">${s.S}</p></div>
                    </div>
                    <div class="flex justify-between text-[9px] font-bold text-slate-400 bg-slate-900/50 p-2 rounded-lg">
                        <div class="text-center"><span class="block text-orange-500 font-black">${s.BA}</span>BÁ</div>
                        <div class="text-center"><span class="block text-violet-500 font-black">${s.IG}</span>IG</div>
                        <div class="text-center"><span class="block text-blue-500 font-black">${s.TU}</span>TU</div>
                        <div class="text-center"><span class="block text-amber-500 font-black">${s.KE}</span>KÉ</div>
                    </div>
                    <button onclick="printA4(${emp.id})" class="w-full mt-3 bg-blue-600 hover:bg-blue-500 text-white py-2 rounded-lg font-bold text-[10px] uppercase transition-all">Nyomtatás</button>
                </div>`;
            }).join('');
        }

        function printA4(empId) {
            const emp = employees.find(e => e.id === empId);
            const year = 2026;
            let rows = ""; let t = { S:0, BA:0, IG:0, TU:0, KE:0 };
            for(let m=1; m<=12; m++) {
                let ms = { S:0, BA:0, IG:0, TU:0, KE:0 };
                Object.keys(emp.data).forEach(k => { if(k.startsWith(`${year}-${m}-`)) { 
                    const v = emp.data[k]; if(!isNaN(v)) ms.S += parseFloat(v); else if(v==='BÁ') ms.BA++; else if(v==='IG') ms.IG++; else if(v==='TU') ms.TU++; else if(v.startsWith('KÉ')) ms.KE++;
                }});
                rows += `<tr><td>${monthNames[m-1]}</td><td>${ms.S}</td><td>${ms.BA}</td><td>${ms.IG}</td><td>${ms.TU}</td><td>${ms.KE}</td></tr>`;
                Object.keys(t).forEach(k => t[k] += ms[k]);
            }
            document.getElementById('print-area').innerHTML = `<div class="print-page">
                <div style="display:flex; justify-content:space-between; align-items:flex-end; border-bottom:2px solid black; padding-bottom:10px">
                    <div><h1 style="margin:0; font-size:24px; color:black">FORVIA</h1><p style="margin:0; font-weight:bold; font-size:10px; color:black">SZEMÉLYI JELENLÉTI ADATLAP - 2026</p></div>
                    <div style="text-align:right"><h2 style="margin:0; font-size:16px; color:black">${emp.name}</h2></div>
                </div>
                <div style="display:flex; justify-content:space-around; margin:15px 0; background:#f0f0f0 !important; border:1px solid #000; padding:10px; font-size:12px; color:black">
                    <div><strong>KERET:</strong> ${emp.yearlyQuota} óra</div>
                    <div><strong>KIVETT:</strong> ${t.S} óra</div>
                    <div><strong>KIVEHETŐ:</strong> ${emp.yearlyQuota - t.S} óra</div>
                </div>
                <table style="width:100%; border-collapse:collapse; text-align:center; font-size:11px; color:black">
                    <thead><tr style="background:#ddd !important; color:black"><th>HÓNAP</th><th>SZAB. (óra)</th><th>BÁ (nap)</th><th>IG</th><th>TU</th><th>KÉ</th></tr></thead>
                    <tbody>${rows}</tbody>
                    <tr style="background:#eee !important; font-weight:bold; color:black"><td>ÖSSZESEN</td><td>${t.S}</td><td>${t.BA}</td><td>${t.IG}</td><td>${t.TU}</td><td>${t.KE}</td></tr>
                </table>
                <div style="margin-top:60px; display:flex; justify-content:flex-end; color:black">
                    <div style="width:200px; border-top:1px solid black; text-align:center; font-size:10px; color:black; padding-top:5px">Munkáltatói igazolás</div>
                </div>
            </div>`;
            window.print();
        }

        function addNewEmployee() { const n = prompt("Dolgozó neve:"); if(n) { const q = prompt("Éves keret (óra):", "160"); employees.push({id:Date.now(), name:n, yearlyQuota:parseInt(q)||0, data:{}}); save(); render(); } }
        function removeEmp(id) { if(confirm("FIGYELEM! Törlöd a dolgozót?")) { employees = employees.filter(e => e.id !== id); save(); render(); if(document.getElementById('view-stats').className === "") renderStats(); } }
        function exportData() { const blob = new Blob([JSON.stringify(employees)], {type: 'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'forvia_2026.json'; a.click(); }
        window.onload = render;
    </script>
</body>
</html>
